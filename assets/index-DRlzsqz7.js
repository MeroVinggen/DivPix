(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class d{static create(){throw'method "create" must be implemented'}}class a{constructor(){this.module=null}setModule(e){this.module=e}}class w extends a{constructor(){super()}handleEvent(e){throw"no handleEvent method implementation"}}class R extends a{constructor(){super(),this.moduleName=null}render(e){throw"render method must be implemented"}renderPixel(e){throw"renderPixel"}}class c{constructor(e){this.target=new e}setPart(e,t){return this.target[e]=t,this.target[e].setModule(this.target),this}build(){return this.target}}class f extends c{constructor(e,t){super(e),this.target.moduleName=t}}class M extends a{constructor({elem:e}){super(),e.addEventListener("input",this)}handleEvent(e){this.onSwitch(e)}onSwitch(e){e.target.checked?this.enable():this.disable()}enable(){this.module.onSwitcherEnable()}disable(){this.module.onSwitcherDisable()}}class x extends a{constructor({elem:e}){super(),this.elem=e}enable(){this.elem.classList.remove("off")}disable(){this.elem.classList.add("off")}}class C extends a{constructor(e){super(),this.elem=e,e.classList.add("renderPoint","hide")}push(e){this.elem.append(e)}clear(){this.elem.innerHTML=""}}class b extends R{onSwitcherDisable(){this.controlsWrap.disable(),this.module.disableRenderModule("html")}onSwitcherEnable(){this.controlsWrap.enable(),this.module.enableRenderModule(this.moduleName,this)}onRenderFinished(e){this.renderPoint.printNewResult(e),this.module.onRendererDone()}onRenderChank(){this.module.onRenderChank()}}class I{startRender(){document.getElementById("waitScreen").classList.remove("hide");const t=this.renderSettingsModule.getFullData(),r=this.imageDataModule.processImage(this.fileModule.image,t.width,t.height);this.renderModule.setRenderPointsWrapSize(t),this.rendersManager.startRenders(r),this.rendersManager.nextRenderer()}addRenderModule(e,t){this.rendersManager.register(e,t.renderer),this.renderModule.addRenderPoint(e,t.renderPoint),t.setModule(this)}disableRenderModule(e){this.rendersManager.remove(e),this.renderModule.disableRenderPoint(e)}enableRenderModule(e,t){this.rendersManager.register(e,t),this.renderModule.enableRenderPoint(e)}onNextRendererStart(e){}onAllRendersDone(){document.getElementById("waitScreen").classList.add("hide"),this.renderModule.show()}onRendererDone(){this.rendersManager.nextRenderer()}onRenderChank(e=1){}}class P extends d{static create(){const e=new c(I),t=k.create(),r=z.create(),n=new O({elem:document.getElementsByClassName("renderBtn")[0]}),i=W.create(),l=K.create();l.init(50);const o=new G;return e.setPart("fileModule",t).setPart("renderBtn",n).setPart("imageDataModule",i).setPart("renderSettingsModule",l).setPart("renderModule",r).setPart("rendersManager",o).build()}}class y extends a{constructor({acceptableFileType:e}){super(),this.acceptableFileType=e}check(e){this.checkFileIsImage(e)?this.module.correctFileType(e):this.module.wrongFileType()}checkFileIsImage({type:e}){return e.split("/")[0]===this.acceptableFileType}}class S extends a{constructor(){super()}convert(e){return new Promise((t,r)=>{const n=new Image;n.onerror=i=>{r(i)},n.onload=()=>{t(n)},n.src=URL.createObjectURL(e)})}}class v extends w{constructor({elem:e}){super(),e.addEventListener("drop",this)}handleEvent(e){e.preventDefault(),this.onDrop(e)}onDrop(e){this.module.setFile(e.dataTransfer.files[0])}}class E extends a{constructor(){super(),this.file=null,this.image=null}async setFile(e){if(e!=null){this.file=e;try{const t=await this.fileConvertToImage.convert(this.file);this.setImage(t)}catch(t){console.error("oups",t)}}}setImage(e){this.image=e}wrongFileType(){console.log("wrongFileType")}correctFileType(e){console.log("correctFileType")}}class k extends d{static create(){const e="image",t=document.getElementById("fileInput"),r=new c(E),n=new V({elem:t}),i=new v({elem:t}),l=new S,o=new y({acceptableFileType:e});return r.setPart("fileSelect",n).setPart("fileDrop",i).setPart("fileConvertToImage",l).setPart("fileCheck",o).build()}}class V extends w{constructor({elem:e}){super(),e.addEventListener("input",this)}handleEvent(e){this.onInput(e)}onInput(e){this.module.setFile(e.target.files[0])}}class N extends d{static create(){const e=new f(b,"html"),t=new M({elem:document.getElementById("htmlRenderCheckbox")}),r=F.create(),n=new x({elem:document.getElementsByClassName("renderSettingsWrap-html")[0]}),i=new B;return e.setPart("renderSwitcher",t).setPart("controlsWrap",n).setPart("renderPoint",r).setPart("renderer",i).build()}}class B extends a{constructor(){super(),this.chanksArr=null,this.curChankIndex=null,this.chanksCount=null,this.fragment=null,this.renderId=null,this.render=this.render.bind(this)}startRender(e){this.initRenderData(e),this.setNextChankRender()}initRenderData(e){this.chanksArr=e,this.chanksCount=e.length,this.curChankIndex=0,this.fragment=document.createDocumentFragment()}checkRenderDone(){return this.curChankIndex===this.chanksCount}renderChank(){this.chanksArr[this.curChankIndex].forEach(e=>{this.fragment.append(this.renderPixel(e)),this.module.onRenderChank()})}setNextChankRender(){this.renderId=requestAnimationFrame(this.render)}render(){this.setNextChankRender(),this.renderChank(),this.curChankIndex+=1,this.checkRenderDone()&&(cancelAnimationFrame(this.renderId),this.onRenderDone())}onRenderDone(){this.module.onRenderFinished(this.fragment),this.reset()}reset(){this.chanksArr=null,this.curChankIndex=null,this.chanksCount=null,this.fragment=null,this.renderId=null}renderPixel(e){const t=document.createElement("div");return t.classList.add("divPixel"),t.style.backgroundColor=e,t}}class D extends C{constructor(e){super(e),e.classList.add("renderPoint-html")}clear(){this.elem.innerHTML=""}printNewResult(e){this.clear(),this.printRenderResult(e)}printRenderResult(e){this.elem.append(e)}}class F extends d{static create(){const e=document.createElement("section");return new D(e)}}class L extends a{constructor({elem:e}){super(),this.сontext=e.getContext("2d")}processImage(e,t,r){return this.clear(t,r),this.getImageData(e,t,r)}clear(e,t){this.сontext.clearRect(0,0,e,t)}getImageData(e,t,r){return this.drawImage(e,t,r),this.getImagePixelsData(t,r)}drawImage(e,t,r){this.сontext.drawImage(e,0,0,t,r)}getImagePixelsData(e,t){const r=[];let n=null,i=null,l=null;for(let o=0;o<t;o+=1){n=[];for(let u=0;u<e;u+=1)i=this.сontext.getImageData(u,o,1,1).data,l=`rgba(${i[0]} ${i[1]} ${i[2]} / ${i[3]/255})`,n.push(l);r.push(n)}return r}}class W{static create(){return new L({elem:document.createElement("canvas")})}}const T=document.getElementById("fileInput"),h=document.getElementsByClassName("fileInputImg")[0];document.getElementsByClassName("renderBtn")[0];const m=document.getElementsByClassName("renderBtnOff")[0],A=document.getElementsByClassName("renderWrap_closeBtn")[0];T.oninput=({target:s})=>{s.value?(h.classList.add("active"),m.classList.add("hide")):(h.classList.remove("active"),m.classList.remove("hide"))};m.onclick=s=>{s.stopPropagation()};h.ondragstart=()=>!1;A.onclick=()=>{document.getElementsByClassName("renderPoint-html")[0].innerHTML=""};class O extends a{constructor({elem:e}){super(),e.addEventListener("click",this)}handleEvent(e){this.onClick()}onClick(){this.module.startRender()}}class H extends a{close(){this.hide(),this.renderViewScaleInput.reset(),this.renderPointsWrap.close()}show(){this.renderWrap.show()}hide(){this.renderWrap.hide()}setRenderPointsWrapSize(e,t){this.renderPointsWrap.setSize(e,t)}addRenderPoint(e,t){this.renderPointsWrap.add(e,t.elem),this.renderViewTabsWrap.add(e,X.create(e))}disableRenderPoint(e){this.renderViewTabsWrap.hide(e)}enableRenderPoint(e){this.renderViewTabsWrap.show(e)}tabClickSignal(e){this.renderPointsWrap.open(e)}}class z extends d{static create(){const e=new c(H),t=new ee(document.getElementsByClassName("renderWrap")[0]),r=new te(document.getElementsByClassName("renderWrap_closeBtn")[0]),n=new q(document.getElementsByClassName("renderPointsWrap")[0]),i=Y.create(),l=new J(document.getElementsByClassName("renderPixelSize_input")[0]);return e.setPart("renderWrap",t).setPart("renderPointsWrap",n).setPart("renderWrapCloseBtn",r).setPart("renderViewTabsWrap",i).setPart("renderViewScaleInput",l).build()}}class q extends a{constructor(e){super(),this.elem=e,this.views=new Map,this.curViewName=null}setSize({height:e,width:t}){this.elem.style.height=e+"px",this.elem.style.width=t+"px"}add(e,t){this.views.set(e,t),this.elem.append(t)}open(e){if(this.curViewName!==null&&this.hideCurView(),this.curViewName===e){this.curViewName=null;return}this.openView(e)}close(){this.curViewName!==null&&this.closeCurView()}openView(e){this.curViewName=e,this.showCurView()}closeCurView(){this.hideCurView(),this.curViewName=null}showCurView(){this.views.get(this.curViewName).classList.remove("hide")}hideCurView(){this.views.get(this.curViewName).classList.add("hide")}}class _ extends a{constructor(){super(),this.value=0}onNewValue(e){this.value=e,this.output.print(e)}updateValue(e){this.onNewValue(e),this.input.setValue(e)}getValue(){return this.value}}class $ extends a{constructor({elem:e}){super(),this.elem=e,e.addEventListener("input",this)}handleEvent(e){this.onInput(e)}setValue(e){this.elem.value=e}signalNewValue(e){this.module.updateValue(e)}onInput(e){const t=Number(e.target.value);this.signalNewValue(t)}}class U extends a{constructor({elem:e}){super(),this.elem=e}print(e){this.elem.textContent=e}}class p extends d{static create({inputElem:e,outputElem:t}){const r=new c(_),n=new $({elem:e}),i=new U({elem:t});return r.setPart("input",n).setPart("output",i).build()}}class j extends a{init(e){this.height.updateValue(e),this.width.updateValue(e)}getFullData(){return{height:this.height.getValue(),width:this.width.getValue()}}}class K extends d{static create(){const e=new c(j),t=p.create({inputElem:document.getElementsByClassName("resolutionInputHeight")[0],outputElem:document.getElementsByClassName("curHeightResolution")[0]}),r=p.create({inputElem:document.getElementsByClassName("resolutionInputWidth")[0],outputElem:document.getElementsByClassName("curWidthResolution")[0]});return e.setPart("height",t).setPart("width",r).build()}}class G extends a{constructor(){super(),this.imageData=null,this.renders=new Map,this.rendersIterator=null}register(e,t){this.renders.set(e,t)}startRenders(e){this.imageData=e,this.getRendersIterator()}remove(e){this.renders.delete(e)}nextRenderer(){const e=this.rendersIterator.next();if(e.done){this.module.onAllRendersDone();return}this.module.onNextRendererStart(e.value[0]),e.value[1].startRender(this.imageData)}getRendersIterator(){this.rendersIterator=this.renders.entries()}}const g=document.getElementsByClassName("renderWrap")[0];class J extends a{constructor(e){super(),this.elem=e,e.addEventListener("input",this)}handleEvent(e){this.onInput(Number(e.target.value))}onInput(e){this.updateScale(e)}updateScale(e){document.body.style.setProperty("--renderPointViewScale",e),requestAnimationFrame(()=>{g.style.backgroundColor="rgba(0, 0, 0, 0.81)",requestAnimationFrame(()=>{g.style.backgroundColor="rgba(0, 0, 0, 0.8)"})})}reset(){this.elem.value=1,this.updateScale(1)}}class Q extends a{constructor(e,t){super(),this.name=e,this.elem=t,this.elem.addEventListener("click",this)}show(){this.elem.classList.remove("hide")}hide(){this.elem.classList.add("hide")}handleEvent(e){this.onClick(e)}onClick(e){this.module.tabClickSignal(this.name)}}class X extends d{static create(e){const t=document.createElement("div");return t.classList.add("renderViewTab"),t.textContent=e,t.dataset.type=e,new Q(e,t)}}class Y extends d{static create(){return new Z(document.getElementsByClassName("renderTabsWrap")[0])}}class Z extends a{constructor(e){super(),this.elem=e,this.tabs=new Map}handleEvent(e){this.onClick(e)}onClick(e){if(console.log(e.target.dataset.type),!e.target.classList.contains("renderViewTab"))return;const r=e.target.dataset.type;this.tabClickSignal(r)}tabClickSignal(e){this.module.tabClickSignal(e)}add(e,t){this.register(e,t),this.insert(t.elem),t.setModule(this)}show(e){this.tabs.get(e).show()}hide(e){this.tabs.get(e).hide()}register(e,t){this.tabs.set(e,t)}insert(e){this.elem.append(e)}}class ee extends a{constructor(e){super(),this.elem=e}show(){this.elem.classList.remove("hide")}hide(){this.elem.classList.add("hide")}}class te extends a{constructor(e){super(),e.addEventListener("click",this)}handleEvent(){this.onClick()}onClick(){this.module.close()}}const se=P.create(),ne=N.create();se.addRenderModule("html",ne);
